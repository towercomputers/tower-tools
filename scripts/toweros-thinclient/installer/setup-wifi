set -e

WIFI_SSID="$1"
WIFI_PASSWORD="$2"

if [ -z "$WIFI_SSID" ]; then
    echo "Please enter the wifi SSID:"
    read WIFI_SSID
fi

if [ -z "$WIFI_PASSWORD" ]; then
    echo "Please enter the wifi password:"
    read WIFI_PASSWORD
fi

set -x

sudo wpa_passphrase "$WIFI_SSID" "$WIFI_PASSWORD" | sudo tee /etc/wpa_supplicant/wpa_supplicant.conf
sudo wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
sudo udhcpc -i wlan0
echo "waiting connection..."
set +x
until ping -c1 www.google.com >/dev/null 2>&1; do :; done
set -x