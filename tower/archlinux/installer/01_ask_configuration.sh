#!/bin/bash

set -e
set +x

ERROR="$1"

DRIVES=`lsscsi -s | sed "{:q;N;s/\n/\!/g;t q}"`
LANGS='aa_DJ.UTF-8!aa_ER!aa_ER@saaho!aa_ET!af_ZA.UTF-8!agr_PE!ak_GH!am_ET!an_ES.UTF-8!anp_IN!ar_AE.UTF-8!ar_BH.UTF-8!ar_DZ.UTF-8!ar_EG.UTF-8!ar_IN!ar_IQ.UTF-8!ar_JO.UTF-8!ar_KW.UTF-8!ar_LB.UTF-8!ar_LY.UTF-8!ar_MA.UTF-8!ar_OM.UTF-8!ar_QA.UTF-8!ar_SA.UTF-8!ar_SD.UTF-8!ar_SS!ar_SY.UTF-8!ar_TN.UTF-8!ar_YE.UTF-8!ayc_PE!az_AZ!az_IR!as_IN!ast_ES.UTF-8!be_BY.UTF-8!be_BY@latin!bem_ZM!ber_DZ!ber_MA!bg_BG.UTF-8!bhb_IN.UTF-8!bho_IN!bho_NP!bi_VU!bn_BD!bn_IN!bo_CN!bo_IN!br_FR.UTF-8!brx_IN!bs_BA.UTF-8!byn_ER!ca_AD.UTF-8!ca_ES.UTF-8!ca_ES@valencia!ca_FR.UTF-8!ca_IT.UTF-8!ce_RU!chr_US!ckb_IQ!cmn_TW!crh_UA!cs_CZ.UTF-8!csb_PL!cv_RU!cy_GB.UTF-8!da_DK.UTF-8!de_AT.UTF-8!de_BE.UTF-8!de_CH.UTF-8!de_DE.UTF-8!de_IT.UTF-8!de_LI.UTF-8!de_LU.UTF-8!doi_IN!dsb_DE!dv_MV!dz_BT!el_GR.UTF-8!el_CY.UTF-8!en_AG!en_AU.UTF-8!en_BW.UTF-8!en_CA.UTF-8!en_DK.UTF-8!en_GB.UTF-8!en_HK.UTF-8!en_IE.UTF-8!en_IL!en_IN!en_NG!en_NZ.UTF-8!en_PH.UTF-8!en_SC.UTF-8!en_SG.UTF-8!en_US.UTF-8!en_ZA.UTF-8!en_ZM!en_ZW.UTF-8!eo!es_AR.UTF-8!es_BO.UTF-8!es_CL.UTF-8!es_CO.UTF-8!es_CR.UTF-8!es_CU!es_DO.UTF-8!es_EC.UTF-8!es_ES.UTF-8!es_GT.UTF-8!es_HN.UTF-8!es_MX.UTF-8!es_NI.UTF-8!es_PA.UTF-8!es_PE.UTF-8!es_PR.UTF-8!es_PY.UTF-8!es_SV.UTF-8!es_US.UTF-8!es_UY.UTF-8!es_VE.UTF-8!et_EE.UTF-8!eu_ES.UTF-8!fa_IR!ff_SN!fi_FI.UTF-8!fil_PH!fo_FO.UTF-8!fr_BE.UTF-8!fr_CA.UTF-8!fr_CH.UTF-8!fr_FR.UTF-8!fr_LU.UTF-8!fur_IT!fy_NL!fy_DE!ga_IE.UTF-8!gd_GB.UTF-8!gez_ER!gez_ER@abegede!gez_ET!gez_ET@abegede!gl_ES.UTF-8!gu_IN!gv_GB.UTF-8!ha_NG!hak_TW!he_IL.UTF-8!hi_IN!hif_FJ!hne_IN!hr_HR.UTF-8!hsb_DE.UTF-8!ht_HT!hu_HU.UTF-8!hy_AM!ia_FR!id_ID.UTF-8!ig_NG!ik_CA!is_IS.UTF-8!it_CH.UTF-8!it_IT.UTF-8!iu_CA!ja_JP.UTF-8!ka_GE.UTF-8!kab_DZ!kk_KZ.UTF-8!kl_GL.UTF-8!km_KH!kn_IN!ko_KR.UTF-8!kok_IN!ks_IN!ks_IN@devanagari!ku_TR.UTF-8!kw_GB.UTF-8!ky_KG!lb_LU!lg_UG.UTF-8!li_BE!li_NL!lij_IT!ln_CD!lo_LA!lt_LT.UTF-8!lv_LV.UTF-8!lzh_TW!mag_IN!mai_IN!mai_NP!mfe_MU!mg_MG.UTF-8!mhr_RU!mi_NZ.UTF-8!miq_NI!mjw_IN!mk_MK.UTF-8!ml_IN!mn_MN!mni_IN!mnw_MM!mr_IN!ms_MY.UTF-8!mt_MT.UTF-8!my_MM!nan_TW!nan_TW@latin!nb_NO.UTF-8!nds_DE!nds_NL!ne_NP!nhn_MX!niu_NU!niu_NZ!nl_AW!nl_BE.UTF-8!nl_NL.UTF-8!nn_NO.UTF-8!nr_ZA!nso_ZA!oc_FR.UTF-8!om_ET!om_KE.UTF-8!or_IN!os_RU!pa_IN!pa_PK!pap_AW!pap_CW!pl_PL.UTF-8!ps_AF!pt_BR.UTF-8!pt_PT.UTF-8!quz_PE!raj_IN!rif_MA!ro_RO.UTF-8!ru_RU.UTF-8!ru_UA.UTF-8!rw_RW!sa_IN!sah_RU!sat_IN!sc_IT!sd_IN!sd_IN@devanagari!se_NO!sgs_LT!shn_MM!shs_CA!si_LK!sid_ET!sk_SK.UTF-8!sl_SI.UTF-8!sm_WS!so_DJ.UTF-8!so_ET!so_KE.UTF-8!so_SO.UTF-8!sq_AL.UTF-8!sq_MK!sr_ME!sr_RS!sr_RS@latin!ss_ZA!st_ZA.UTF-8!sv_FI.UTF-8!sv_SE.UTF-8!sw_KE!sw_TZ!syr!szl_PL!ta_IN!ta_LK!tcy_IN.UTF-8!te_IN!tg_TJ.UTF-8!th_TH.UTF-8!the_NP!ti_ER!ti_ET!tig_ER!tk_TM!tl_PH.UTF-8!tn_ZA!to_TO!tpi_PG!tr_CY.UTF-8!tr_TR.UTF-8!ts_ZA!tt_RU!tt_RU@iqtelif!ug_CN!uk_UA.UTF-8!unm_US!ur_IN!ur_PK!uz_UZ.UTF-8!uz_UZ@cyrillic!ve_ZA!vi_VN!wa_BE.UTF-8!wae_CH!wal_ET!wo_SN!xh_ZA.UTF-8!yi_US.UTF-8!yo_NG!yue_HK!yuw_PG!zh_CN.UTF-8!zh_HK.UTF-8!zh_SG.UTF-8!zh_TW.UTF-8!zu_ZA.UTF-8'
TIMEZONES='UTC!Africa/Abidjan!Africa/Accra!Africa/Addis_Ababa!Africa/Algiers!Africa/Asmara!Africa/Asmera!Africa/Bamako!Africa/Bangui!Africa/Banjul!Africa/Bissau!Africa/Blantyre!Africa/Brazzaville!Africa/Bujumbura!Africa/Cairo!Africa/Casablanca!Africa/Ceuta!Africa/Conakry!Africa/Dakar!Africa/Dar_es_Salaam!Africa/Djibouti!Africa/Douala!Africa/El_Aaiun!Africa/Freetown!Africa/Gaborone!Africa/Harare!Africa/Johannesburg!Africa/Juba!Africa/Kampala!Africa/Khartoum!Africa/Kigali!Africa/Kinshasa!Africa/Lagos!Africa/Libreville!Africa/Lome!Africa/Luanda!Africa/Lubumbashi!Africa/Lusaka!Africa/Malabo!Africa/Maputo!Africa/Maseru!Africa/Mbabane!Africa/Mogadishu!Africa/Monrovia!Africa/Nairobi!Africa/Ndjamena!Africa/Niamey!Africa/Nouakchott!Africa/Ouagadougou!Africa/Porto-Novo!Africa/Sao_Tome!Africa/Timbuktu!Africa/Tripoli!Africa/Tunis!Africa/Windhoek!America/Adak!America/Anchorage!America/Anguilla!America/Antigua!America/Araguaina!America/Argentina/Buenos_Aires!America/Argentina/Catamarca!America/Argentina/ComodRivadavia!America/Argentina/Cordoba!America/Argentina/Jujuy!America/Argentina/La_Rioja!America/Argentina/Mendoza!America/Argentina/Rio_Gallegos!America/Argentina/Salta!America/Argentina/San_Juan!America/Argentina/San_Luis!America/Argentina/Tucuman!America/Argentina/Ushuaia!America/Aruba!America/Asuncion!America/Atikokan!America/Atka!America/Bahia!America/Bahia_Banderas!America/Barbados!America/Belem!America/Belize!America/Blanc-Sablon!America/Boa_Vista!America/Bogota!America/Boise!America/Buenos_Aires!America/Cambridge_Bay!America/Campo_Grande!America/Cancun!America/Caracas!America/Catamarca!America/Cayenne!America/Cayman!America/Chicago!America/Chihuahua!America/Ciudad_Juarez!America/Coral_Harbour!America/Cordoba!America/Costa_Rica!America/Creston!America/Cuiaba!America/Curacao!America/Danmarkshavn!America/Dawson!America/Dawson_Creek!America/Denver!America/Detroit!America/Dominica!America/Edmonton!America/Eirunepe!America/El_Salvador!America/Ensenada!America/Fort_Nelson!America/Fort_Wayne!America/Fortaleza!America/Glace_Bay!America/Godthab!America/Goose_Bay!America/Grand_Turk!America/Grenada!America/Guadeloupe!America/Guatemala!America/Guayaquil!America/Guyana!America/Halifax!America/Havana!America/Hermosillo!America/Indiana/Indianapolis!America/Indiana/Knox!America/Indiana/Marengo!America/Indiana/Petersburg!America/Indiana/Tell_City!America/Indiana/Vevay!America/Indiana/Vincennes!America/Indiana/Winamac!America/Indianapolis!America/Inuvik!America/Iqaluit!America/Jamaica!America/Jujuy!America/Juneau!America/Kentucky/Louisville!America/Kentucky/Monticello!America/Knox_IN!America/Kralendijk!America/La_Paz!America/Lima!America/Los_Angeles!America/Louisville!America/Lower_Princes!America/Maceio!America/Managua!America/Manaus!America/Marigot!America/Martinique!America/Matamoros!America/Mazatlan!America/Mendoza!America/Menominee!America/Merida!America/Metlakatla!America/Mexico_City!America/Miquelon!America/Moncton!America/Monterrey!America/Montevideo!America/Montreal!America/Montserrat!America/Nassau!America/New_York!America/Nipigon!America/Nome!America/Noronha!America/North_Dakota/Beulah!America/North_Dakota/Center!America/North_Dakota/New_Salem!America/Nuuk!America/Ojinaga!America/Panama!America/Pangnirtung!America/Paramaribo!America/Phoenix!America/Port-au-Prince!America/Port_of_Spain!America/Porto_Acre!America/Porto_Velho!America/Puerto_Rico!America/Punta_Arenas!America/Rainy_River!America/Rankin_Inlet!America/Recife!America/Regina!America/Resolute!America/Rio_Branco!America/Rosario!America/Santa_Isabel!America/Santarem!America/Santiago!America/Santo_Domingo!America/Sao_Paulo!America/Scoresbysund!America/Shiprock!America/Sitka!America/St_Barthelemy!America/St_Johns!America/St_Kitts!America/St_Lucia!America/St_Thomas!America/St_Vincent!America/Swift_Current!America/Tegucigalpa!America/Thule!America/Thunder_Bay!America/Tijuana!America/Toronto!America/Tortola!America/Vancouver!America/Virgin!America/Whitehorse!America/Winnipeg!America/Yakutat!America/Yellowknife!Antarctica/Casey!Antarctica/Davis!Antarctica/DumontDUrville!Antarctica/Macquarie!Antarctica/Mawson!Antarctica/McMurdo!Antarctica/Palmer!Antarctica/Rothera!Antarctica/South_Pole!Antarctica/Syowa!Antarctica/Troll!Antarctica/Vostok!Arctic/Longyearbyen!Asia/Aden!Asia/Almaty!Asia/Amman!Asia/Anadyr!Asia/Aqtau!Asia/Aqtobe!Asia/Ashgabat!Asia/Ashkhabad!Asia/Atyrau!Asia/Baghdad!Asia/Bahrain!Asia/Baku!Asia/Bangkok!Asia/Barnaul!Asia/Beirut!Asia/Bishkek!Asia/Brunei!Asia/Calcutta!Asia/Chita!Asia/Choibalsan!Asia/Chongqing!Asia/Chungking!Asia/Colombo!Asia/Dacca!Asia/Damascus!Asia/Dhaka!Asia/Dili!Asia/Dubai!Asia/Dushanbe!Asia/Famagusta!Asia/Gaza!Asia/Harbin!Asia/Hebron!Asia/Ho_Chi_Minh!Asia/Hong_Kong!Asia/Hovd!Asia/Irkutsk!Asia/Istanbul!Asia/Jakarta!Asia/Jayapura!Asia/Jerusalem!Asia/Kabul!Asia/Kamchatka!Asia/Karachi!Asia/Kashgar!Asia/Kathmandu!Asia/Katmandu!Asia/Khandyga!Asia/Kolkata!Asia/Krasnoyarsk!Asia/Kuala_Lumpur!Asia/Kuching!Asia/Kuwait!Asia/Macao!Asia/Macau!Asia/Magadan!Asia/Makassar!Asia/Manila!Asia/Muscat!Asia/Nicosia!Asia/Novokuznetsk!Asia/Novosibirsk!Asia/Omsk!Asia/Oral!Asia/Phnom_Penh!Asia/Pontianak!Asia/Pyongyang!Asia/Qatar!Asia/Qostanay!Asia/Qyzylorda!Asia/Rangoon!Asia/Riyadh!Asia/Saigon!Asia/Sakhalin!Asia/Samarkand!Asia/Seoul!Asia/Shanghai!Asia/Singapore!Asia/Srednekolymsk!Asia/Taipei!Asia/Tashkent!Asia/Tbilisi!Asia/Tehran!Asia/Tel_Aviv!Asia/Thimbu!Asia/Thimphu!Asia/Tokyo!Asia/Tomsk!Asia/Ujung_Pandang!Asia/Ulaanbaatar!Asia/Ulan_Bator!Asia/Urumqi!Asia/Ust-Nera!Asia/Vientiane!Asia/Vladivostok!Asia/Yakutsk!Asia/Yangon!Asia/Yekaterinburg!Asia/Yerevan!Atlantic/Azores!Atlantic/Bermuda!Atlantic/Canary!Atlantic/Cape_Verde!Atlantic/Faeroe!Atlantic/Faroe!Atlantic/Jan_Mayen!Atlantic/Madeira!Atlantic/Reykjavik!Atlantic/South_Georgia!Atlantic/St_Helena!Atlantic/Stanley!Australia/ACT!Australia/Adelaide!Australia/Brisbane!Australia/Broken_Hill!Australia/Canberra!Australia/Currie!Australia/Darwin!Australia/Eucla!Australia/Hobart!Australia/LHI!Australia/Lindeman!Australia/Lord_Howe!Australia/Melbourne!Australia/NSW!Australia/North!Australia/Perth!Australia/Queensland!Australia/South!Australia/Sydney!Australia/Tasmania!Australia/Victoria!Australia/West!Australia/Yancowinna!Brazil/Acre!Brazil/DeNoronha!Brazil/East!Brazil/West!CET!CST6CDT!Canada/Atlantic!Canada/Central!Canada/Eastern!Canada/Mountain!Canada/Newfoundland!Canada/Pacific!Canada/Saskatchewan!Canada/Yukon!Chile/Continental!Chile/EasterIsland!Cuba!EET!EST!EST5EDT!Egypt!Eire!Etc/GMT!Etc/GMT+0!Etc/GMT+1!Etc/GMT+10!Etc/GMT+11!Etc/GMT+12!Etc/GMT+2!Etc/GMT+3!Etc/GMT+4!Etc/GMT+5!Etc/GMT+6!Etc/GMT+7!Etc/GMT+8!Etc/GMT+9!Etc/GMT-0!Etc/GMT-1!Etc/GMT-10!Etc/GMT-11!Etc/GMT-12!Etc/GMT-13!Etc/GMT-14!Etc/GMT-2!Etc/GMT-3!Etc/GMT-4!Etc/GMT-5!Etc/GMT-6!Etc/GMT-7!Etc/GMT-8!Etc/GMT-9!Etc/GMT0!Etc/Greenwich!Etc/UCT!Etc/UTC!Etc/Universal!Etc/Zulu!Europe/Amsterdam!Europe/Andorra!Europe/Astrakhan!Europe/Athens!Europe/Belfast!Europe/Belgrade!Europe/Berlin!Europe/Bratislava!Europe/Brussels!Europe/Bucharest!Europe/Budapest!Europe/Busingen!Europe/Chisinau!Europe/Copenhagen!Europe/Dublin!Europe/Gibraltar!Europe/Guernsey!Europe/Helsinki!Europe/Isle_of_Man!Europe/Istanbul!Europe/Jersey!Europe/Kaliningrad!Europe/Kiev!Europe/Kirov!Europe/Kyiv!Europe/Lisbon!Europe/Ljubljana!Europe/London!Europe/Luxembourg!Europe/Madrid!Europe/Malta!Europe/Mariehamn!Europe/Minsk!Europe/Monaco!Europe/Moscow!Europe/Nicosia!Europe/Oslo!Europe/Paris!Europe/Podgorica!Europe/Prague!Europe/Riga!Europe/Rome!Europe/Samara!Europe/San_Marino!Europe/Sarajevo!Europe/Saratov!Europe/Simferopol!Europe/Skopje!Europe/Sofia!Europe/Stockholm!Europe/Tallinn!Europe/Tirane!Europe/Tiraspol!Europe/Ulyanovsk!Europe/Uzhgorod!Europe/Vaduz!Europe/Vatican!Europe/Vienna!Europe/Vilnius!Europe/Volgograd!Europe/Warsaw!Europe/Zagreb!Europe/Zaporozhye!Europe/Zurich!Factory!GB!GB-Eire!GMT!GMT+0!GMT-0!GMT0!Greenwich!HST!Hongkong!Iceland!Indian/Antananarivo!Indian/Chagos!Indian/Christmas!Indian/Cocos!Indian/Comoro!Indian/Kerguelen!Indian/Mahe!Indian/Maldives!Indian/Mauritius!Indian/Mayotte!Indian/Reunion!Iran!Israel!Jamaica!Japan!Kwajalein!Libya!MET!MST!MST7MDT!Mexico/BajaNorte!Mexico/BajaSur!Mexico/General!NZ!NZ-CHAT!Navajo!PRC!PST8PDT!Pacific/Apia!Pacific/Auckland!Pacific/Bougainville!Pacific/Chatham!Pacific/Chuuk!Pacific/Easter!Pacific/Efate!Pacific/Enderbury!Pacific/Fakaofo!Pacific/Fiji!Pacific/Funafuti!Pacific/Galapagos!Pacific/Gambier!Pacific/Guadalcanal!Pacific/Guam!Pacific/Honolulu!Pacific/Johnston!Pacific/Kanton!Pacific/Kiritimati!Pacific/Kosrae!Pacific/Kwajalein!Pacific/Majuro!Pacific/Marquesas!Pacific/Midway!Pacific/Nauru!Pacific/Niue!Pacific/Norfolk!Pacific/Noumea!Pacific/Pago_Pago!Pacific/Palau!Pacific/Pitcairn!Pacific/Pohnpei!Pacific/Ponape!Pacific/Port_Moresby!Pacific/Rarotonga!Pacific/Saipan!Pacific/Samoa!Pacific/Tahiti!Pacific/Tarawa!Pacific/Tongatapu!Pacific/Truk!Pacific/Wake!Pacific/Wallis!Pacific/Yap!Poland!Portugal!ROC!ROK!Singapore!Turkey!UCT!US/Alaska!US/Aleutian!US/Arizona!US/Central!US/East-Indiana!US/Eastern!US/Hawaii!US/Indiana-Starke!US/Michigan!US/Mountain!US/Pacific!US/Samoa!UTC!Universal!W-SU!WET!Zulu'
KEYBOARDS='us!101_qwerty_comma_dead!101_qwerty_comma_nodead!101_qwerty_dot_dead!101_qwerty_dot_nodead!101_qwertz_comma_dead!101_qwertz_comma_nodead!101_qwertz_dot_dead!101_qwertz_dot_nodead!102_qwerty_comma_dead!102_qwerty_comma_nodead!102_qwerty_dot_dead!102_qwerty_dot_nodead!102_qwertz_comma_dead!102_qwertz_comma_nodead!102_qwertz_dot_dead!102_qwertz_dot_nodead!CloGaelach!OADG109A!T3!UnicodeExpert!ab!adapted!afnor!akan!alt!alt-gb!alt-intl!alt-us!alternatequotes!altgr-intl!altgr-pinyin!apostrophe!ar!ara!ast!avn!azb!azerty!azerty-deadkeys!azerty_digits!bak!bas_phonetic!bekl!ben!ben_baishakhi!ben_bornona!ben_gitanjali!ben_inscript!ben_probhat!bepo!bepo_afnor!bepo_latin9!ber!biblical!bksl!bolnagri!bre!buckwalter!capewell-dvorak!capewell-dvorak-bay!capewell-qwerf2k6!capewell-qwerf2k6-bay!cat!chm!chr!classic!colemak!colemak-bay!colemak_dh!colemak_dh_iso!colemak_dh_ortho!crh!crh_alt!crh_f!csb!cv!cv_latin!cyrillic!cyrillicalternatequotes!cyrillicyz!de_mac!de_nodeadkeys!deadacute!deadgraveacute!deadtilde!digits!dos!dsb!dsb_qwertz!dvorak!dvorak-alt-intl!dvorak-bay!dvorak-classic!dvorak-intl!dvorak-l!dvorak-mac!dvorak-r!dvorak-ucw!dvorak_altquotes!dvorak_quotes!dvorakukp!dvp!e!e1!e2!eastern!eastern-alt!eeyek!eng!ergonomic!euro!ewe!ext!extd!extended!f!fa-olpc!fkey!fr!fr-dvorak!fr-legacy!fr-oss!fr_mac!fr_nodeadkeys!french!fula!fur!ga!gag!generic!geo!gillbt!gla!guj!guj-kagapa!guru!hausa!haw!hbs!hin-kagapa!hin-wx!homophonic!ibm!igbo!iipa!ike!indigenous!intl!iso-alternate!javanese!jhelum!kan!kan-kagapa!kana!kana86!kazrus!kik!kom!kr104!ku!ku_alt!ku_ara!ku_f!latin!latin9!latin9_nodeadkeys!latinalternatequotes!latinunicode!latinunicodeyz!latinyz!left_hand!left_hand_invert!legacy!lekp!lekpa!lyx!mac!macOS!mac_intl!mac_legacy!mac_nodeadkeys!mal!mal_enhanced!mal_lalitha!mar-kagapa!marathi!melayu-phonetic!melayu-phoneticx!mess!mmuock!mnw!mnw-a1!modern!modern-cyr!mon_manchu_galik!mon_todo_galik!mon_trad!mon_trad_galik!mon_trad_manchu!mon_trad_todo!mon_trad_xibe!multix!nativo!nativo-epo!nativo-us!neo!nodeadkeys!norman!oci!ogam!ogam_is434!olck!olpc!olpc2!ori!ori-bolnagri!ori-wx!os!os_legacy!os_winkeys!oss!oss_latin9!oss_nodeadkeys!ot!otf!otk!otkf!pat!pegon-phonetic!pes_keypad!phonetic!phonetic-alt!phonetic_YAZHERTY!phonetic_azerty!phonetic_dvorak!phonetic_fr!phonetic_winkeys!pl!plisi!polytonic!probhat!ps!ps-olpc!qwerty!qwerty-bay!qwerty-gb-deadkeys!qwerty-mac!qwerty-us-deadkeys!qwerty_bksl!qwerty_digits!qwertz!ratise!rif!right_hand!right_hand_invert!ro!ro_nodeadkeys!rstu!rstu_ru!ru!ru_phonetic_dvorak!ruchey_en!ruchey_ru!rue!rus!rus_nodeadkeys!ruskaz!sah!saisiyat!san-kagapa!scn!sgs!shn!simple!smi!smi_nodeadkeys!snd!srp!standard!std!stea!svdvorak!swl!syc!syc_phonetic!symbolic!szl!tam!tam_TAB!tam_tamilnumbers!tam_unicode!tamilnet!tamilnet_TAB!tamilnet_TSCII!tamilnet_tamilnumbers!tel!tel-kagapa!tel-sarala!thinkpad!tib!tib_asciinum!tifinagh!tifinagh-alt!tifinagh-alt-phonetic!tifinagh-extended!tifinagh-extended-phonetic!tifinagh-phonetic!tilde!tis!tr!tt!typewriter!typewriter-legacy!ucw!udm!ug!unicode!unicodeus!urd-crulp!urd-nla!urd-phonetic!urd-phonetic3!urd-winkeys!us!us-intl!us-mac!us_dvorak!uz!uz-olpc!veqilharxhi!wang!western!winkeys!workman!workman-intl!xal!yoruba!yz!zawgyi!zgt'

args=()
args+=( '--form' '--title' 'Tower Computing' )
args+=( '--text' '<b><big>\nTower Distribution Installation\n</big></b>' )
args+=( '--fixed' '--center' '--sticky' )
args+=( '--field' 'Target Disk:CB' "$DRIVES" )
args+=( '--field' "<span foreground='red'>Please note that all data on the chosen disk will be destroyed FOREVER</span>:LBL" "" )
args+=( '--field' ':LBL' "" )
args+=( '--field' 'Localization:LBL' "" )
args+=( '--field' 'Language:CB' "$LANGS" )
args+=( '--field' 'Timezone:CB' "$TIMEZONES" )
args+=( '--field' 'Keyboard:CB' "$KEYBOARDS" )
args+=( '--field' ':LBL' "" )
args+=( '--field' 'User:LBL' "" )
args+=( '--field' 'Login' 'tower')
args+=( '--field' 'Password:H' '')
args+=( '--field' 'Confirm password:H' '' )
if ! [ -z "$ERROR" ]; then 
    args+=( '--field' ':LBL' "" )
    args+=( '--field' "<span foreground='red'><big>$ERROR</big></span>:LBL" "" )
fi
YADCONF=$(sudo xinit /usr/bin/yad "${args[@]}" $* -- :0 vt1)
#YADCONF=$(yad "${args[@]}")

if [ -z "$YADCONF" ]; then
    echo "Installation canceled. Type 'sh intall_tower.sh' to restart the installation."
    exit 1
fi

set +e
TARGET_DRIVE=$(echo $YADCONF | awk 'BEGIN {FS="|" } { print $1 }' | rev | cut -d' ' -f 2 | rev)
LANG=$(echo $YADCONF | awk 'BEGIN {FS="|" } { print $5 }')
TIMEZONE=$(echo $YADCONF | awk 'BEGIN {FS="|" } { print $6 }')
KEYMAP=$(echo $YADCONF | awk 'BEGIN {FS="|" } { print $7 }')
USERNAME=$(echo $YADCONF | awk 'BEGIN {FS="|" } { print $10 }')
PASSWORD=$(echo $YADCONF | awk 'BEGIN {FS="|" } { print $11 }')
CONFIRM_PASSWORD=$(echo $YADCONF | awk 'BEGIN {FS="|" } { print $12 }')
set -e

FORM_ERROR=()
if ! [[ "$USERNAME" =~ ^[[:alpha:][:digit:]_-]{3,32}$ ]]; then
    FORM_ERROR+=('Username is invalid')
fi
if [ -z "$PASSWORD" ]; then
    FORM_ERROR+=('Password is required')
fi
if [ "$PASSWORD" != "$CONFIRM_PASSWORD" ]; then
    FORM_ERROR+=('Two passwords must be identical')
fi

FORM_ERROR=$(printf ", %s" "${FORM_ERROR[@]}")
FORM_ERROR=${FORM_ERROR:2}

if ! [ -z "$FORM_ERROR" ]; then 
    sh ./01_ask_configuration.sh "$FORM_ERROR"
    exit 0
fi

echo "TARGET_DRIVE=\"$TARGET_DRIVE\"" > ./tower.env
echo "ROOT_PASSWORD=\"$PASSWORD\"" >> ./tower.env
echo "USERNAME=\"$USERNAME\"" >> ./tower.env
echo "PASSWORD=\"$PASSWORD\"" >> ./tower.env
echo "LANG=\"$LANG\"" >> ./tower.env
echo "TIMEZONE=\"$TIMEZONE\"" >> ./tower.env
echo "KEYMAP=\"$KEYMAP\"" >> ./tower.env

# sudo xinit /usr/bin/zenity --entry $* -- :0 vt1 > answer.txt
